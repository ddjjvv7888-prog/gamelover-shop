<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameLover V3 - Final</title>
    <style>
        body { font-family: sans-serif; background: #f3e5f5; text-align: center; padding: 20px; }
        .box { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 400px; margin: 0 auto; }
        h1 { color: #4b0082; margin: 0; }
        .balance { font-size: 2.5rem; color: #00d26a; font-weight: bold; margin: 20px 0; }
        .status { color: #666; font-size: 0.9rem; margin-bottom: 20px; }
        button { background: #4b0082; color: #ffd700; border: none; padding: 12px 24px; font-size: 1rem; border-radius: 50px; cursor: pointer; font-weight: bold; }
        .uid { font-family: monospace; background: #eee; padding: 5px; border-radius: 5px; font-size: 0.8rem; word-break: break-all; }
    </style>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // --- CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyBZoKyWmeNSELvqVm8barRKp3alPy-GdGk",
            authDomain: "gamelovershop-d3b47.firebaseapp.com",
            projectId: "gamelovershop-d3b47",
            storageBucket: "gamelovershop-d3b47.firebasestorage.app",
            messagingSenderId: "782424722391",
            appId: "1:782424722391:web:41a9cbbf897c3ad1dd1992"
        };

        // INIT
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ELEMENTS
        const statusEl = document.getElementById('status');
        const balanceEl = document.getElementById('balance');
        const uidEl = document.getElementById('uid');
        const btn = document.getElementById('action-btn');
        const loginForm = document.getElementById('login-area');
        const dashArea = document.getElementById('dash-area');

        // LOGIC
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // LOGGED IN
                loginForm.style.display = 'none';
                dashArea.style.display = 'block';
                statusEl.innerText = "üü¢ Connected as " + user.email;
                uidEl.innerText = "UID: " + user.uid;
                btn.innerText = "Log Out";
                btn.onclick = () => signOut(auth);

                // LISTEN TO DATA
                statusEl.innerText = "üü° Fetching Wallet...";
                const userRef = doc(db, "users", user.uid);
                
                onSnapshot(userRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        console.log("DATA FOUND:", data);
                        balanceEl.innerText = (data.balance || 0) + " G";
                        statusEl.innerText = "‚úÖ Live Sync Active";
                    } else {
                        statusEl.innerText = "‚ö†Ô∏è No Wallet Found. Creating...";
                        setDoc(userRef, { balance: 0, email: user.email });
                    }
                }, (error) => {
                    console.error(error);
                    statusEl.innerText = "‚ùå ERROR: " + error.message;
                    balanceEl.innerText = "ERR";
                });

            } else {
                // LOGGED OUT
                loginForm.style.display = 'block';
                dashArea.style.display = 'none';
                statusEl.innerText = "‚ö™ Please Login";
            }
        });

        // LOGIN FUNCTION
        window.doLogin = async () => {
            const e = document.getElementById('email').value;
            const p = document.getElementById('pass').value;
            try {
                statusEl.innerText = "üîµ Logging in...";
                await signInWithEmailAndPassword(auth, e, p);
            } catch (err) {
                alert(err.message);
                statusEl.innerText = "‚ùå Login Failed";
            }
        };
    </script>
</head>
<body>

    <div class="box">
        <h1>GameLover V3</h1>
        <p id="status" class="status">Initializing...</p>

        <div id="dash-area" style="display:none;">
            <p>Your Wallet Balance:</p>
            <div id="balance" class="balance">...</div>
            <p id="uid" class="uid">...</p>
            <button id="action-btn">Log Out</button>
        </div>

        <div id="login-area">
            <input type="email" id="email" placeholder="Email" style="padding:10px; width:80%; margin:5px 0;">
            <input type="password" id="pass" placeholder="Password" style="padding:10px; width:80%; margin:5px 0;">
            <br><br>
            <button onclick="window.doLogin()">Login</button>
        </div>
    </div>

</body>
</html>
